<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2018-05-12 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20180512" />
    <meta http-equiv="Content-Language" content="en" />
    <title>microBean Helm &#x2013; Examples</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
      <script type="text/javascript" src="./js/apache-maven-fluido-1.6.min.js"></script>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>microBean Helm</h2>
</div>
</div>
        <div class="pull-right"><a href="./" id="bannerRight"><img src="https://avatars0.githubusercontent.com/u/25515632?s=60"  alt="Âµb microbean-helm"/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2018-05-12</li>
      <li id="projectVersion" class="pull-right">Version: 2.8.2.1.0.6</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header">Documentation</li>
    <li><a href="index.html" title="Overview"><span class="none"></span>Overview</a>  </li>
    <li><a href="apidocs/index.html" title="JavaDocs"><span class="none"></span>JavaDocs</a>  </li>
    <li><a href="https://github.com/microbean/microbean-helm/" class="externalLink" title="Github Repository"><span class="none"></span>Github Repository</a>  </li>
    <li class="active"><a href="#"><span class="none"></span>Examples</a>
  </li>
          <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a>  </li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Examples</h1>
<p>Here are some examples showing how to use the microbean-helm project.</p>
<p>First, some concepts.</p>
<div class="section">
<h2><a name="Chart.Builder_vs._ChartOrBuilder"></a><tt>Chart.Builder</tt> vs. <tt>ChartOrBuilder</tt></h2>
<p>Google&#x2019;s Protocol Buffers&#x2014;which underlies the Tiller API, and hence substantial portions of the microbean-helm project&#x2014;makes a <a class="externalLink" href="https://developers.google.com/protocol-buffers/docs/javatutorial#builders">distinction between builders and messages</a>. A <tt>Chart.Builder</tt> is a builder for a <tt>Chart</tt>, and both <tt>Chart.Builder</tt> and <tt>Chart</tt> implement the <tt>ChartOrBuilder</tt> interface. These classes are all generated by microbean-helm straight off of protocol buffers source code, so their names and overall shape cannot be changed or altered.</p>
<p>In general, if all you care about are the &#x201c;read&#x201d; methods in a Tiller-related object, then you want the <tt>&amp;hellip;OrBuilder</tt> interface. If you are building something up, then you need a <tt>&amp;hellip;.Builder</tt> class.</p></div>
<div class="section">
<h2><a name="Loading_a_Chart"></a>Loading a Chart</h2>
<p>Here is an example showing how to load a chart from a URL, with exception handling omitted for brevity:</p>

<div class="source">
<div class="source"><pre class="prettyprint">import java.net.URI;
import java.net.URL;

import java.util.Collection;

import hapi.chart.ChartOuterClass.ChartOrBuilder;
import hapi.chart.MetadataOuterClass.MetadataOrBuilder;

import org.microbean.helm.chart.URLChartLoader;

final URI uri = URI.create(&quot;https://kubernetes-charts.storage.googleapis.com/wordpress-0.6.6.tgz&quot;);
assert uri != null;
final URL url = uri.toURL();
assert url != null;
ChartOrBuilder chart = null;
try (final URLChartLoader chartLoader = new URLChartLoader()) {
  chart = chartLoader.load(url);
}
assert chart != null;
final MetadataOrBuilder metadata = chart.getMetadataOrBuilder();
assert metadata != null;
assert &quot;wordpress&quot;.equals(metadata.getName());
assert &quot;0.6.6&quot;.equals(metadata.getVersion());
final Collection&lt;? extends ChartOrBuilder&gt; subcharts = chart.getDependenciesOrBuilderList();
assert subcharts != null;
assert subcharts.size() == 1;
</pre></div></div></div>
<div class="section">
<h2><a name="Installing_a_Release"></a>Installing a Release</h2>
<p>This example shows loading a <tt>Chart.Builder</tt> from a URL, and then using it to install a release into a Kubernetes cluster. This is analogous to a <tt>helm install</tt> operation.</p>

<div class="source">
<div class="source"><pre class="prettyprint">import java.net.URI;
import java.net.URL;

import java.util.Collection;

import java.util.concurrent.Future;

import hapi.chart.ChartOuterClass.Chart;

import hapi.release.ReleaseOuterClass.Release;

import hapi.services.tiller.Tiller.InstallReleaseRequest;
import hapi.services.tiller.Tiller.InstallReleaseResponse;

import io.fabric8.kubernetes.client.DefaultKubernetesClient;

import org.microbean.helm.ReleaseManager;
import org.microbean.helm.Tiller;

import org.microbean.helm.chart.URLChartLoader;

final URI uri = URI.create(&quot;https://kubernetes-charts.storage.googleapis.com/wordpress-0.6.6.tgz&quot;);
assert uri != null;
final URL url = uri.toURL();
assert url != null;
Chart.Builder chart = null;
try (final URLChartLoader chartLoader = new URLChartLoader()) {
  chart = chartLoader.load(url);
}
assert chart != null;

try (final DefaultKubernetesClient client = new DefaultKubernetesClient();
     final Tiller = new Tiller(client);
     final ReleaseManager releaseManager = new ReleaseManager(tiller)) {

  final InstallReleaseRequest.Builder requestBuilder = InstallReleaseRequest.newBuilder();
  assert requestBuilder != null;
  requestBuilder.setTimeout(300L);
  requestBuilder.setName(&quot;test-charts&quot;); // Set the Helm release name
  requestBuilder.setWait(true); // Wait for Pods to be ready
  // Install the loaded chart with no user-supplied overrides.
  // To override any values, call the requestBuilder.getValuesBuilder() method,
  // and add values to the resulting Builder, using its setRaw(String) method,
  // which takes a YAML string.
  //
  // Why setRaw(String)? Due to limitations in Tiller itself, Tiller will use
  // only the return value from Config.Builder#getRaw()
  // (https://microbean.github.io/microbean-helm/apidocs/hapi/chart/ConfigOuterClass.Config.Builder.html#getRaw--),
  // which is taken to be a YAML String representing the user-supplied overrides.
  // Tiller ignores any other values-related &quot;getter&quot; methods.
  final Future&lt;InstallReleaseResponse&gt; releaseFuture = releaseManager.install(requestBuilder, chartBuilder);
  assert releaseFuture != null;
  final Release release = releaseFuture.get().getRelease();
  assert release != null;
}
</pre></div></div></div>
<div class="section">
<h2><a name="Installing_a_Release_With_User-Supplied_Overriding_Values"></a>Installing a Release With User-Supplied Overriding Values</h2>
<p>This example shows loading a <tt>Chart.Builder</tt> from a URL, and then using it to install a release into a Kubernetes cluster with user-supplied overriding values. This is analogous to a <tt>helm install
--set wordpressEmail=&quot;sample@example.com&quot;</tt> operation, or a <tt>helm
install -f ./userValues.yaml</tt> operation.</p>

<div class="source">
<div class="source"><pre class="prettyprint">import java.net.URI;
import java.net.URL;

import java.util.Collection;
import java.util.LinkedHashMap;
import java.util.Map;

import java.util.concurrent.Future;

import hapi.chart.ChartOuterClass.Chart;

import hapi.release.ReleaseOuterClass.Release;

import hapi.services.tiller.Tiller.InstallReleaseRequest;
import hapi.services.tiller.Tiller.InstallReleaseResponse;

import io.fabric8.kubernetes.client.DefaultKubernetesClient;

import org.microbean.helm.ReleaseManager;
import org.microbean.helm.Tiller;

import org.microbean.helm.chart.URLChartLoader;

import org.yaml.snakeyaml.Yaml;

final URI uri = URI.create(&quot;https://kubernetes-charts.storage.googleapis.com/wordpress-0.6.6.tgz&quot;);
assert uri != null;
final URL url = uri.toURL();
assert url != null;
Chart.Builder chart = null;
try (final URLChartLoader chartLoader = new URLChartLoader()) {
  chart = chartLoader.load(url);
}
assert chart != null;

try (final DefaultKubernetesClient client = new DefaultKubernetesClient();
     final Tiller = new Tiller(client);
     final ReleaseManager releaseManager = new ReleaseManager(tiller)) {

  final InstallReleaseRequest.Builder requestBuilder = InstallReleaseRequest.newBuilder();
  assert requestBuilder != null;
  requestBuilder.setTimeout(300L);
  requestBuilder.setName(&quot;test-charts&quot;); // Set the Helm release name
  requestBuilder.setWait(true); // Wait for Pods to be ready

  // Create a structure that will hold user-supplied overriding values.
  final Map&lt;String, Object&gt; yaml = new LinkedHashMap&lt;&gt;();
  yaml.put(&quot;wordpressEmail&quot;, &quot;sample@example.com&quot;);
  
  // Convert it to a YAML string using SnakeYaml.
  final String yamlString = new Yaml().dump(yaml);
  
  // Set the user-supplied values in the only way that will be readable by
  // Tiller.  For some reason, Tiller itself only ever looks at the return
  // value of Config.Builder#getRaw(), and no other values-related &quot;getter&quot;
  // method.
  requestBuilder.getValuesBuilder().setRaw(yamlString);
  
  // Install the loaded chart with the user-supplied overrides.
  final Future&lt;InstallReleaseResponse&gt; releaseFuture = releaseManager.install(requestBuilder, chartBuilder);
  assert releaseFuture != null;
  final Release release = releaseFuture.get().getRelease();
  assert release != null;
}
</pre></div></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2017&#x2013;2018
<a href="http://microbean.systems/">microBean</a>.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
